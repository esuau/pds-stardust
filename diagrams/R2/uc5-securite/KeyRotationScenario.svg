<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1029" height="650" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant CRON
participant KMS
participant VAULT

CRON->KMS: Triggers keys rotation
Note over KMS,VAULT: Communication over secure channel
KMS->VAULT: Asks for KEK rotation
Note right of VAULT: KEK version will be incremented
VAULT->VAULT: Rotates the KEK
KMS->VAULT: Asks for the DEK secret
VAULT-->KMS: Returns the DEK secret
KMS->KMS: Base 64 decode the encrypted DEK
KMS->VAULT: Sends rewrap DEK request
VAULT->VAULT: Rewraps the DEK using the KEK
VAULT-->KMS: Returns the rewraped DEK
KMS->KMS: Base 64 encoded the rewraped DEK
KMS->VAULT: Sends DEK secret update

]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="58.40625" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="20" y="44.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">CRON</tspan></text></g><g class="actor"><rect x="10" y="592" width="58.40625" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="20" y="616.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">CRON</tspan></text></g><line x1="39.203125" x2="39.203125" y1="58" y2="592" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="246.03125" y="20" width="48.8125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="256.03125" y="44.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="256.03125">KMS</tspan></text></g><g class="actor"><rect x="246.03125" y="592" width="48.8125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="256.03125" y="616.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="256.03125">KMS</tspan></text></g><line x1="270.4375" x2="270.4375" y1="58" y2="592" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="583.6796875" y="20" width="68.015625" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="593.6796875" y="44.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="593.6796875">VAULT</tspan></text></g><g class="actor"><rect x="583.6796875" y="592" width="68.015625" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="593.6796875" y="616.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="593.6796875">VAULT</tspan></text></g><line x1="617.6875" x2="617.6875" y1="58" y2="592" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="signal"><text x="49.203125" y="88.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="49.203125">Triggers keys rotation</tspan></text><line x1="39.203125" x2="270.4375" y1="96" y2="96" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="260.4375" y="116" width="367.25" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="265.4375" y="135.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="265.4375">Communication over secure channel</tspan></text></g><g class="signal"><text x="343.2421875" y="174.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="343.2421875">Asks for KEK rotation</tspan></text><line x1="270.4375" x2="617.6875" y1="182" y2="182" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="637.6875" y="202" width="307.65625" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="642.6875" y="221.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="642.6875">KEK version will be incremented</tspan></text></g><g class="signal"><text x="642.6875" y="264" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="642.6875">Rotates the KEK</tspan></text><line x1="617.6875" x2="637.6875" y1="250" y2="250" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="637.6875" x2="637.6875" y1="250" y2="273" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="637.6875" x2="617.6875" y1="273" y2="273" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="333.640625" y="298.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="333.640625">Asks for the DEK secret</tspan></text><line x1="270.4375" x2="617.6875" y1="306" y2="306" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="338.4453125" y="336.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="338.4453125">Returns the DEK secret</tspan></text><line x1="617.6875" x2="270.4375" y1="344" y2="344" stroke="#000000" fill="none" style="stroke-width: 2px; stroke-dasharray: 6px, 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="295.4375" y="378" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="295.4375">Base 64 decode the encrypted DEK</tspan></text><line x1="270.4375" x2="290.4375" y1="364" y2="364" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="290.4375" x2="290.4375" y1="364" y2="387" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="290.4375" x2="270.4375" y1="387" y2="387" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="328.84375" y="412.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="328.84375">Sends rewrap DEK request</tspan></text><line x1="270.4375" x2="617.6875" y1="420" y2="420" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="642.6875" y="454" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="642.6875">Rewraps the DEK using the KEK</tspan></text><line x1="617.6875" x2="637.6875" y1="440" y2="440" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="637.6875" x2="637.6875" y1="440" y2="463" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="637.6875" x2="617.6875" y1="463" y2="463" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="328.84375" y="488.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="328.84375">Returns the rewraped DEK</tspan></text><line x1="617.6875" x2="270.4375" y1="496" y2="496" stroke="#000000" fill="none" style="stroke-width: 2px; stroke-dasharray: 6px, 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="295.4375" y="530" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="295.4375">Base 64 encoded the rewraped DEK</tspan></text><line x1="270.4375" x2="290.4375" y1="516" y2="516" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="290.4375" x2="290.4375" y1="516" y2="539" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><line x1="290.4375" x2="270.4375" y1="539" y2="539" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="333.640625" y="564.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="333.640625">Sends DEK secret update</tspan></text><line x1="270.4375" x2="617.6875" y1="572" y2="572" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g></svg>